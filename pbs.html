<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible"/>
    <title>Prebid Test</title>
    <script src="prebid4.15.0.js"></script>
    <script>
        var PREBID_TIMEOUT = 1000;
        var publisherId = 42939;
        var adUnits = [
            {
                code: "ad_slot",
                mediaTypes: {
                    banner: {
                        sizes: [[240, 480]]
                    }
                },
                bids: [
                    {
                        bidder: "between",
                        params: {
                            host: 'lbs-ru1.ads',
                            publisher_id: publisherId.toString(),
                            tag_id: '3979084',
                            site_id: '609638',
                            bid_floor: '0.000003',
                            bid_floor_cur: 'USD',
                        }
                    }
                ]
            }
        ];
        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];
    </script>
    <script>
        pbjs.que.push(function () {
            pbjs.que.push(function () {
                pbjs.setConfig({
                    s2sConfig: {
                        accountId: '1',
                        enabled: true,
                        bidders: ['between'],
                        timeout: 1000,
                        adapter: 'prebidServer',
                        endpoint: '//pbs.egorskorokhodov.ru/openrtb2/auction',
                        syncEndpoint: '//pbs.egorskorokhodov.ru/cookie_sync',
                        syncUrlModifier: {
                            'between': function (type, url) {
                                url += encodeURIComponent(`&bidder_id=${publisherId}`);
                                return url
                            }
                        },
                    }
                });
            });
            pbjs.addAdUnits(adUnits);
            pbjs.requestBids({
                bidsBackHandler: sendAdserverRequest
            });
        });

        function sendAdserverRequest() {
            if (pbjs.adserverRequestSent) return;
            pbjs.adserverRequestSent = true;
            var params = pbjs.getAdserverTargetingForAdUnitCode("ad_slot");
            var iframe = document.getElementById("ad_slot");
            var iframeDoc = iframe.contentWindow.document;
            if (params && params["hb_adid"]) {
                pbjs.renderAd(iframeDoc, params["hb_adid"]);
            }
        }

        setTimeout(function () {
            sendAdserverRequest();
        }, PREBID_TIMEOUT);
    </script>
</head>
<body>
<iframe id="ad_slot"></iframe>
</body>
</html>
